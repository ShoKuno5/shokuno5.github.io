---
import PostMeta from './PostMeta.astro';

export type TagLink = {
  label: string;
  href?: string;
  action?: string;
};

export interface Props {
  id?: string;
  title: string;
  href?: string;
  titleTag?: 'h1' | 'h2' | 'h3';
  description?: string;
  publishedDate?: Date | null;
  updatedDate?: Date | null;
  pinned?: boolean;
  pills?: TagLink[];
  tagLinks?: TagLink[];
  tagPrefix?: string;
  dataTags?: string;
  className?: string;
  bodyClassName?: string;
  reveal?: boolean;
  dataPost?: boolean;
}

const {
  id,
  title,
  href = undefined,
  titleTag = 'h1',
  description,
  publishedDate = null,
  updatedDate = null,
  pinned = false,
  pills = [],
  tagLinks = [],
  tagPrefix = '#',
  dataTags = '',
  className = '',
  bodyClassName = '',
  reveal = false,
  dataPost = false,
} = Astro.props;

const articleClass = ['post-item', className].filter(Boolean).join(' ');
const hasBody = Astro.slots.has('default');
const hasAfter = Astro.slots.has('after');
const resolvedTitleTag = titleTag || 'h1';
const bodyClass = ['post-body', 'markdown-body', bodyClassName].filter(Boolean).join(' ');
---

<article
  id={id}
  class={articleClass}
  data-tags={dataTags || undefined}
  data-reveal={reveal ? '' : undefined}
  data-post={dataPost ? '' : undefined}
>
  {href ? (
    <a class="post-item__title" href={href}>{title}</a>
  ) : (
    resolvedTitleTag === 'h2' ? (
      <h2 class="post-item__title">{title}</h2>
    ) : resolvedTitleTag === 'h3' ? (
      <h3 class="post-item__title">{title}</h3>
    ) : (
      <h1 class="post-item__title">{title}</h1>
    )
  )}

  <PostMeta
    publishedDate={publishedDate}
    updatedDate={updatedDate}
    pinned={pinned}
    pills={pills}
    tagLinks={tagLinks}
    tagPrefix={tagPrefix}
  />

  {description && <p class="post-item__excerpt">{description}</p>}

  {hasBody && (
    <div class={bodyClass}>
      <slot />
    </div>
  )}

  {hasAfter && <slot name="after" />}
</article>
