---
import Layout from './Layout.astro';
import { calculateReadingTime } from '../utils/readingTime';
import { normalizeTag } from '../utils/tags';

export interface Props {
  title: string;
  date?: Date;
  modified?: Date;
  tags?: string[];
  description?: string;
  content?: string;
}

const {
  title,
  date,
  modified,
  tags,
  description,
  content,
} = Astro.props as Props;

const readingTime = content ? calculateReadingTime(content) : null;

const publishLabel = date
  ? `Published ${date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`
  : null;
const updatedLabel = date && modified && modified.getTime() !== date.getTime()
  ? `Updated ${modified.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}`
  : null;
const readingLabel = readingTime
  ? `${readingTime.readingTimeText}${readingTime.wordCount ? ` - ${readingTime.wordCount} words` : ''}`
  : null;

const metaItems = [publishLabel, updatedLabel, readingLabel].filter(Boolean);
---

<Layout title={title} description={description}>
  <article class="post-shell">
    <header class="post-header">
      <h1 class="post-title">{title}</h1>
      {description && <p class="post-summary">{description}</p>}

      {metaItems.length > 0 && (
        <ul class="post-meta">
          {metaItems.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      )}

      {tags && tags.length > 0 && (
        <ul class="post-tags">
          {tags.map((tag) => (
            <li>
              <a class="post-tag" href={`/tags/#tag-${normalizeTag(tag)}`}>
                #{tag}
              </a>
            </li>
          ))}
        </ul>
      )}
    </header>

    <div class="post-body markdown-body citations-enabled">
      <slot />
    </div>
  </article>
</Layout>
