---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';
import TimelineScript from '../components/scripts/TimelineScript.astro';
import { SITE } from '../config/site.js';
import {
  filterPublishedIssues,
  sortIssuesByPubDateDesc,
  toIssueDisplayTitle,
  toIssueEditionLabel,
} from '../utils/issues';

const issues = sortIssuesByPubDateDesc(filterPublishedIssues(await getCollection('issues')));
---

<Layout
  title={`${SITE.name} - Editions`}
  description="Editorial editions that curate related posts into a guided sequence."
>
  <header class="intro">
    <h1 class="intro-title">Editions</h1>
    <p class="intro-lede">Curated sequences of posts with editorial context and reading order.</p>
  </header>

  {issues.length === 0 ? (
    <p class="topic-empty">No editions published yet. Check back soon for the first release.</p>
  ) : (
    <section class="post-list" aria-label="Editions">
      {issues.map((issue) => (
        <PostCard
          title={toIssueDisplayTitle(issue.data.title)}
          href={`/issues/${issue.slug}/`}
          description={issue.data.description}
          publishedDate={issue.data.pubDate}
          pills={[
            {
              label: toIssueEditionLabel(issue.data.title, issue.slug),
            },
            {
              label: `${issue.data.items.length} post${issue.data.items.length === 1 ? '' : 's'}`,
            },
          ]}
          dataPost
          reveal
        />
      ))}
    </section>
  )}

  <TimelineScript slot="scripts" />
</Layout>
